<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess vs AI (Stockfish)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.min.js"></script>
    <!-- Use the latest Chessboard.js from unpkg -->
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.js"></script>
    <style>
        .glass {
            background: rgba(38, 36, 43, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-dark {
            background: rgba(28, 26, 33, 0.95);
        }
        .hover-up {
            transition: transform 0.15s ease;
        }
        .hover-up:hover {
            transform: translateY(-1px);
        }
        .gradient-button {
            background: #4169e1;
        }
        .gradient-button:hover {
            background: #3154b3;
        }
        .spinner {
            display: none;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        body.no-scroll-body {
            overflow: hidden;
        }
        .highlight-selected {
            background-color: rgba(155, 199, 0, 0.41) !important;
        }
        .highlight-move {
            background-color: rgba(155, 199, 0, 0.41) !important;
        }

        .aspect-square {
    aspect-ratio: 1 / 1;
        }

            /* Ensure the board container isn't clipped */
            #game-container {
    overflow: visible !important;
        }

        .relative {
    overflow: visible !important;
        }

        /* Chess.com-like board styles */
        .white-1e1d7 {
            background-color: #edeed1;
        }
        .black-3c85d {
            background-color: #779952;
        }
        
        /* Modern layout adjustments */
        .game-layout {
            display: grid;
            grid-template-columns: auto 300px;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .move-list {
            background: rgba(38, 36, 43, 0.95);
            padding: 1rem;
            border-radius: 8px;
            height: 400px;
        }
        
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .controls button, 
        .controls select {
            width: 100%;
            min-height: 2.5rem;
        }

        .controls .flex {
            display: flex;
            gap: 0.75rem;
        }

        .controls .flex select,
        .controls .flex button {
            flex: 1;
        }
        
        body {
            background: #302e2c !important;
            color: #ffffff;
        }
        
        select, button {
            background: #404040;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }
        
        select:hover, button:hover {
            background: #4a4a4a;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="w-full p-4">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-bold text-white">Chess Game</h1>
            <div id="user-info" class="flex items-center space-x-2">
                <span id="username-display" class="text-lg"></span>
                <button id="logout-button" class="p-2 bg-red-500 text-white rounded hover:bg-red-600 hidden" aria-label="Logout">Logout</button>
            </div>
        </div>

        <div id="game-container" class="hidden game-layout">
            <div class="board-section">
                <div class="relative w-full aspect-square max-w-2xl">
                    <div id="board" class="w-full h-full"></div>
                    <svg id="hint-arrow" class="absolute inset-0 w-full h-full pointer-events-none hidden">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 3.5, 0 7" fill="currentColor" />
                            </marker>
                        </defs>
                        <path fill="none" stroke="currentColor" stroke-width="2" marker-end="url(#arrowhead)" />
                    </svg>
                </div>
            </div>
            
            <div class="control-panel">
                <div class="move-list">
                    <div class="max-h-full overflow-y-auto">
                        <ul id="move-history" class="list-none"></ul>
                    </div>
                </div>
                
                <div class="controls space-y-2">
                    <div class="flex space-x-3">
                        <select id="difficulty" class="glass dark:glass-dark p-3 rounded-lg hover-up" aria-label="Select difficulty">
                            <option value="Easy">Easy</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Hard">Hard</option>
                        </select>
                        <select id="player-color" class="glass dark:glass-dark p-3 rounded-lg hover-up" aria-label="Select player color">
                            <option value="White">White</option>
                            <option value="Black">Black</option>
                        </select>
                        <button id="interaction-mode" class="glass dark:glass-dark p-3 rounded-lg hover-up" aria-label="Toggle interaction mode">
                            <span id="mode-text">Tap to Move</span>
                        </button>
                    </div>
                    <button id="reset-button" class="gradient-button p-3 text-white rounded-lg hover-up shadow-lg flex items-center justify-center" aria-label="Reset game">
                        <span>Reset</span>
                        <span class="spinner"></span>
                    </button>
                    <button id="save-button" class="bg-gradient-to-r from-emerald-500 to-green-600 p-3 text-white rounded-lg hover-up shadow-lg flex items-center justify-center" aria-label="Save game">
                        <span>Save Game</span>
                        <span class="spinner"></span>
                    </button>
                    <button id="resume-button" class="bg-gradient-to-r from-amber-500 to-yellow-600 p-3 text-white rounded-lg hover-up shadow-lg flex items-center justify-center" aria-label="Resume game">
                        <span>Resume Game</span>
                        <span class="spinner"></span>
                    </button>
                    <button id="hint-button" class="gradient-button p-3 text-white rounded-lg hover-up shadow-lg flex items-center justify-center" aria-label="Get hint">
                        <span>Get Hint</span>
                        <span class="spinner"></span>
                    </button>
                    <button id="dark-mode-toggle" class="glass dark:glass-dark p-3 rounded-lg hover-up" aria-label="Toggle dark mode">
                        <span id="sun" class="hidden">‚òÄÔ∏è</span>
                        <span id="moon">üåô</span>
                    </button>
                    <div id="status" class="text-xl font-semibold" aria-live="polite"></div>
                    <div class="w-full glass dark:glass-dark rounded-full h-2">
                        <div class="probability-fill bg-gradient-to-r from-green-400 to-emerald-500 h-full rounded-full transition-all duration-300"></div>
                    </div>
                    <div id="probability" class="text-center">50%</div>
                    <div id="hint" class="hidden text-center text-blue-500 dark:text-blue-400"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Promotion Modal -->
    <div id="promotion-modal" class="hidden fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center">
        <div class="glass dark:glass-dark p-6 rounded-xl shadow-2xl transform transition-all duration-300 scale-95 hover:scale-100">
            <h2 class="text-lg font-bold mb-2">Choose Promotion</h2>
            <div class="flex space-x-3">
                <button class="promotion-option gradient-button p-3 text-white rounded-lg hover-up shadow-lg" data-promotion="q" aria-label="Promote to Queen">Queen</button>
                <button class="promotion-option p-2 bg-blue-500 text-white rounded hover:bg-blue-600" data-promotion="r" aria-label="Promote to Rook">Rook</button>
                <button class="promotion-option p-2 bg-blue-500 text-white rounded hover:bg-blue-600" data-promotion="b" aria-label="Promote to Bishop">Bishop</button>
                <button class="promotion-option p-2 bg-blue-500 text-white rounded hover:bg-blue-600" data-promotion="n" aria-label="Promote to Knight">Knight</button>
            </div>
        </div>
    </div>

    <!-- Resume Game Modal -->
    <div id="resume-modal" class="hidden fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center">
        <div class="glass dark:glass-dark p-8 rounded-xl shadow-2xl transform transition-all duration-300 scale-95 hover:scale-100 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 text-center">Resume a Saved Game</h2>
            <div class="relative mb-6">
                <select id="game-list" class="w-full p-3 border-2 rounded-lg appearance-none dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 focus:outline-none focus:border-blue-500 transition-colors duration-200" aria-label="Select a saved game">
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </div>
            </div>
            <div class="flex space-x-4">
                <button id="load-game-button" class="flex-1 p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transform hover:scale-105 transition-all duration-200 font-semibold flex items-center justify-center" aria-label="Load selected game">
                    <span>Load Game</span>
                    <span class="spinner"></span>
                </button>
                <button onclick="$('#resume-modal').addClass('hidden')" class="flex-1 p-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transform hover:scale-105 transition-all duration-200 font-semibold" aria-label="Cancel">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
    <script>
        // Prevent body scrolling when game is active
        $(document).ready(function() {
            const $body = $('body');
            $('#game-container').on('touchstart', function() {
                $body.addClass('no-scroll-body');
            });
            $('#game-container').on('touchend', function() {
                $body.removeClass('no-scroll-body');
            });
        });
    </script>
</body>
</html>